package amp

import (
	"encoding/hex"
	"github.com/stretchr/testify/require"
	"testing"
)

func TestNext(t *testing.T) {

	buff, err := hex.DecodeString(`f07e7f060200010c240002006b001f01f7000000f000010c24027e7f06024c36496d616765547970653a6d61696e004c36496d61676556657273696f6e3a312e332e312e302e6b00f7000000f000010c24024d000c00000b000100000004000000006b0031010000f7000000f000010c24024d000d00000b00010000000400000000000000000000f7000000f000010c24024d000e00000800010000000100000000000000000000f7000000f000010c24024d011400000b00010000000400000000000000000000f7000000f000010c24024d011500000b00010000000400000000000000000000f7000000f000010c24024d011600000b00010000000400000000000000000000f7000000f000010c24024d011700000b00010000000400000000000000000000f7000000f000010c24024d011800000b00010000000400000000000000000000f7000000`)
	require.NoError(t, err)

	// f07e7f060200010c240002006b001f01f7
	// first message is discarded because it is in an unknown format

	// f000010c24027e7f06024c36496d616765547970653a6d61696e004c36496d61676556657273696f6e3a312e332e312e302e6b00f7
	// second message uses unknown preamble

	//the first decodable message is this one
	var msg1 []byte
	msg1, buff = Next(buff)
	require.EqualValues(t, "f000010c24024d000c00000b000100000004000000006b0031010000f7", hex.EncodeToString(msg1))

}
